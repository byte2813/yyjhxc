const BASE_URL='https://games.hndibei.com';class EyouClientV2{constructor(){let m=null,a=0x1,Q=null,z=null,y='-1',X='-1',G=0x4,R=null,u=null,K=null,B=null,n=null,P=null,W=null,h=null,F=null,C=null,t=null;const N=I=>{m=I;const r=wx['getSystemInfoSync']();G=r['platform']==='android'?'4':r['platform']==='ios'?'5':'6';const Y=wx['getLaunchOptionsSync']()['query'];Q=Y['channel'],z=Y['sub_channel'],console['log']('游戏初始化参数',z);const A={'10908':['ad_id','clue_token'],'10918':['ad_id','clue_token'],'10912':['weixinadinfo'],'10913':['ksUnitId','callback'],'10914':['uid','bd_vid'],'10916':['aid','trackid'],'10917':['campaignid','uctrackid'],'10919':['promotion_id','clue_token'],'10920':['ADID','imp','mark_id']};if(A['hasOwnProperty'](Q)){const [J,H,S]=A[Q];if(J==='weixinadinfo'){const g=Y['weixinadinfo'];if(g){const O=g['split']('.');y=O[0x0],X=O[0x1];}}else y=Y[J],X=Y[H],!X&&S&&(X=Y[S]);}else Q='10906',z=''+m+a+Q+G+'0';console['log']('游戏初始化参数=>',z);},p=()=>{wx['onShareAppMessage'](()=>{}),wx['onShareTimeline'](()=>{}),wx['showShareMenu']({'menus':['shareAppMessage','shareTimeline']});},U=()=>{return new Promise((I,r)=>{wx['login']({'success':({code:Y})=>{Y?I(Y):r(new Error('获取code失败'));},'fail':r});});},D=(I,r)=>{return new Promise((Y,A)=>{wx['request']({'url':I,'method':'POST','header':{'Content-Type':'application/json'},'data':JSON['stringify'](r),'fail':A,'success':function(J){Y(J['data']);},'complete':function(J){console['log']('---------------------------------请求\x20BEGIN--------------------------------'),console['log']('Url:>',I),console['log']('请求参数:>',r),console['log']('响应:>',J['data']||J['errMsg']),console['log']('---------------------------------请求\x20END--------------------------------');}});});},E=BASE_URL+'/market-wechat-game-server/wxTransfer/showTransfer',d=async I=>{try{const r={'gameId':m,'platformId':a,'transferNodeType':I,'userId':u,'sys':G},Y=await D(E,r);if(Y['code']===CodeStatus['SUCCESS']){const {transferType:A,showText:J,copyText:H,pictureUrl:S,showTip:g}=Y['data'];if(A===0x1)wx['showModal']({'title':'公告','content':J,'confirmText':'复制链接','success':function(O){O['confirm']&&wx['setClipboardData']({'data':H});}});else{if(A===0x2)wx['previewImage']({'urls':[S+'?time='+Math['floor'](Date['now']()/0x3e8)]});else A===0x3&&g('公告',g);}}else console['log']('公告展示失败:',Y['message']);return{'success':!![],'result':Y};}catch(O){return console['error']('[展示公告]异常:',O),{'success':![],'error':error};}},L=BASE_URL+'/market-wechat-game-server/wxClient/decryptData',v=async(I,r,Y,A)=>{const J={'gameId':m,'platformId':a,'decryptDataType':I,'userId':u,'encryptedData':r,'iv':Y},H=0x3;let S=0x0,g=![],O;while(S<H&&!g){try{O=await D(L,J);O['code']===CodeStatus['GAME_SESSION_KEY_TIME_OUT_ERR']&&await i();if(O['code']===CodeStatus['SUCCESS']){A(O);break;}}catch(m0){console['error']('[解密用户隐私数据失败]异常:>',m0);}S++;}},j=(I,r)=>{I['gameId']=m,(I['platformId']=a,I['sys']=G),console['log']('支付拉起开始时间:'+Date['now']()),k(I)['then'](Y=>{if(Y['payType']==0x1)Y['balance']>0x0?x('充值提示','账户余额:'+Y['balance']+'元,\x20还需充值:'+Y['needPay']+'元',()=>V(Y)):V(Y,r);else{if(Y['payType']==0x2||Y['payType']==0xa)e(Y,r);else{if(Y['payType']==0x4)wx['showModal']({'title':'充值提示','content':'即将展示充值二维码,\x20请扫描二维码完成支付','success':function(A){A['confirm']&&wx['previewImage']({'urls':[Y['payUrl']]});}});else throw new Error('非法支付类型');}}});},V=(I,r)=>{if(I['needPay']==0x0){T(I,r);return;}console['log']('米大师拉起支付进入:'+Date['now']()),wx['requestMidasPayment']({'mode':'game','env':0x0,'offerId':I['offerId'],'currencyType':'CNY','platform':'android','buyQuantity':I['needPay']*I['midasRate'],'zoneId':'1','success':Y=>{console['log']('米大师拉起支付deduct进入:'+Date['now']()),T(I,r),console['log']('米大师拉起支付处理完成:'+Date['now']());},'fail':Y=>{x('微信支付失败',Y);}});},e=(I,r)=>{wx['openCustomerServiceConversation']({'showMessageCard':!![],'sessionFrom':I['payUrl'],'sendMessagePath':'/index.wxml?url='+I['payUrl'],'sendMessageTitle':'发送卡片充值','sendMessageImg':I['payIconUrl']});},b=BASE_URL+'/market-wechat-game-server/wxClient/deduct',T=async(I,r)=>{const Y={'orderId':I['orderId'],'gameId':m,'platformId':a,'userId':I['userId']},A=0x3;let J=0x0,H=![],S;while(J<A&&!H){try{S=await D(b,Y);S['code']===CodeStatus['GAME_SESSION_KEY_TIME_OUT_ERR']&&await i();if(S['code']===CodeStatus['SUCCESS']){r(S);break;}}catch(g){console['error']('[扣款失败]异常:>',g);}J++;}},f=BASE_URL+'/market-wechat-game-server/wxClient/pullPay',k=async I=>{const r=0x3;let Y=0x0,A=![],J=![];while(Y<r&&!A){try{const H=await D(f,I);console['log']('拉起支付结果',JSON['stringify'](H));if(H['code']===CodeStatus['SUCCESS'])return console['log']('支付拉起返回结果时间:'+Date['now']()),H['data'];else H['code']===CodeStatus['GAME_SESSION_KEY_TIME_OUT_ERR']?await i():!J&&(x('支付拉起失败',H['message']),J=!![]);}catch(S){!J&&(x('支付拉起失败','网络超时'),J=!![]);}Y++;}throw new Error('支付拉起失败');},l=BASE_URL+'/market-wechat-game-server/wxClient/refreshSession',i=async()=>{const I=0x3;let r=0x0,Y=![];while(r<I&&!Y){try{const A=await U(),J={'gameId':m,'platformId':a,'code':A},H=await D(l,J);Y=H['code']===CodeStatus['SUCCESS'];}catch(S){console['error']('[刷新会话失败]异常:>',S),r++;}}if(!Y)throw new Error('刷新会话失败');},q=BASE_URL+'/market-wechat-game-server/wxClient/adAction',x=(I,r,Y,A)=>{wx['showModal']({'title':I,'content':r,'success':function(J){if(J['confirm']&&Y)Y();else J['cancel']&&A&&A();}});},c=(I,r,Y)=>{let A={'gameId':m,'platformId':a,'channelId':Q,'subChannelId':z,'aid':y,'traceId':X,'sys':G,'userId':u,'adType':I,'adUnitId':r,'adActionType':Y};D(q,A)['catch'](J=>{console['log']('发送广告行为失败:>',J);});},s=()=>{if(!F)throw new Error('未创建录屏管理器');},w=(I,r)=>{wx['getSetting']({'success':Y=>{!Y['authSetting'][I]?wx['authorize']({'scope':I,'success':()=>{r();}}):wx['authorize']({'scope':I,'success':()=>{r();}});}});},M=BASE_URL+'/market-wechat-game-server/wxClient/initGame';this['init']=async(I,r)=>{try{p(),N(I);const Y=await U(),A={'code':Y,'gameId':m,'platformId':a,'channelId':Q,'subChannelId':z,'aid':y,'traceId':X,'sys':G},J=await D(M,A);console['log']('游戏初始化',J),J['code']===CodeStatus['SUCCESS']&&(u=J['data']['userId'],K=J['data']['unionId'],R=Y,C=J['data']['gameClubOpenLinkId'],J['data']=null),r(J);}catch(H){console['error']('[初始化游戏]异常:>',H);}},this['login']=async I=>{try{const r=await d(0x1);(!r['success']||r['result']['code']!=0x0||r['result']['data']['transferType']!=0x3)&&I({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':{'code':R}});}catch(Y){console['error']('[登录游戏]异常:>',Y);}},this['pay']=async(I,r)=>{try{const Y=await d(0x2);(!Y['success']||Y['result']['code']!=0x0)&&j(I,r);}catch(A){console['error']('[支付拉起]异常:>',A);}};const Z=BASE_URL+'/market-wechat-game-server/wxClient/uploadRoleInfo';this['uploadRoleInfo']=async(I,r)=>{try{I['gameId']=m,I['platformId']=a;const Y=await D(Z,I);r(Y);}catch(A){console['error']('上报角色数据异常:>',A);}};const o=BASE_URL+'/market-wechat-game-server/wxServer/msgSecCheck';this['msgSecCheck']=async(I,r)=>{I['gameId']=m,I['platformId']=a;try{const Y=await D(o,I);r(Y);}catch(A){console['error']('[文本安全检测]异常:>',A);}},this['createRewardedVideoAd']=(I,r)=>{if(!wx['createRewardedVideoAd']){x('提示','基础库版本号过低,\x20暂不支持展示激励视频');return;}if(B!=I['adUnitId']){if(n){n['destory'](),B=null,n=null,this['createRewardedVideoAd'](I,r);return;}let Y={'adUnitId':I['adUnitId'],'multiton':!![]};I['multiton']&&(Y['multiton']=I['multiton']),n=wx['createRewardedVideoAd'](Y),n['onError'](A=>console['log']('激励视频程序出错:>',A)),n['onClose'](A=>{A&&A['isEnded']||A===undefined?(c(AdType['REWARDED_VIDEO_AD'],B,AdActionType['FINISHED']),I['onClose']&&I['onClose']({'code':CodeStatus['SUCCESS'],'message':'播放完成','data':null})):I['onClose']&&I['onClose']({'code':CodeStatus['FAILED'],'message':'播放未完成','data':null});}),B=I['adUnitId'];}r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['showRewardedVideoAd']=()=>{n&&n['show']()['then'](()=>c(AdType['REWARDED_VIDEO_AD'],B,AdActionType['SHOW']))['catch'](()=>{n['load']()['then'](()=>n['show']()['then'](()=>c(AdType['REWARDED_VIDEO_AD'],B,AdActionType['SHOW'])))['catch'](I=>console['log']('激励视频\x20广告显示失败'));});},this['createBannerAd']=(I,r)=>{if(!wx['createBannerAd']){x('提示','基础库版本号过低,\x20暂不支持展示Banner广告');return;}if(P!=I['adUnitId']){if(W){W['destory'](),P=null,W=null,createBannerAd(I,r);return;}let Y={'adUnitId':I['adUnitId'],'style':I['style']};I['adIntervals']&&(Y['adIntervals']=I['adIntervals']),W=wx['createBannerAd'](Y),W['onLoad'](()=>{c(AdType['BANNER_AD'],P,AdActionType['FINISHED']);}),W['onError'](A=>console['log']('banner广告程序出错:>',A)),P=I['adUnitId'];}r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['showBannerAd']=()=>{W&&W['show']();},this['hideBannerAd']=()=>{W&&W['hide']();},this['setStorageSync']=(I,r)=>{wx['setStorageSync'](I,r);},this['removeStorageSync']=I=>{wx['removeStorageSync'](I);},this['getStorageSync']=I=>{return wx['getStorageSync'](I);},this['getUserInfo']=(I,r)=>{wx['getSetting']({'success':Y=>{Y['authSetting']['scope.userInfo']?wx['getUserInfo']({'success':A=>{r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':A['userInfo']});},'fail':A=>{r({'code':A['errno'],'message':A['errMsg'],'data':null});}}):(h=wx['createUserInfoButton'](I),h['onTap'](A=>{A['userInfo']?r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':A['userInfo']}):r({'code':CodeStatus['FAILED'],'message':A['errMsg'],'data':null});}));}});},this['destroyCreateUserInfoButton']=()=>{h&&(console['log'](h),h['destroy'](),h=null);},this['hideCreateUserInfoButton']=()=>{h&&h['hide']();},this['showCreateUserInfoButton']=()=>{h&&h['show']();},this['createGameRecorder']=(I,r)=>{F=wx['getGameRecorder'](),I['onStart']&&F['on']('start',I['onStart']),I['onResume']&&F['on']('resume',I['onResume']),I['onPause']&&F['on']('pause',I['onPause']),I['onStop']&&F['on']('stop',I['onStop']),I['onError']&&F['on']('error',I['onError']),I['onAbort']&&F['on']('abort',I['onAbort']),I['onTimeUpdate']&&F['on']('timeUpdate',I['onTimeUpdate']),r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['gameRecorderStart']=I=>{s(),F['start'](I);},this['gameRecorderPause']=()=>{s(),F['pause']();},this['gameRecorderResume']=()=>{s(),F['resume']();},this['gameRecorderStop']=()=>{s(),F['stop']();},this['operateGameRecorderVideo']=(I,r)=>{wx['operateGameRecorderVideo']({...I,'success':()=>{r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},'fail':Y=>{console['log']('[分享对局失败]:>',Y),r({'code':CodeStatus['FAIL'],'message':'操作失败','data':null});}});},this['getGameClubData']=(I,r)=>{w('scope.gameClubData',()=>{wx['getGameClubData']({'dataTypeList':I['dataTypeList'],'success':Y=>{v(0x1,Y['encryptedData'],Y['iv'],r);},'fail':Y=>{console['error']('[获取游戏圈数据失败]:>',Y);}});});},this['createGameClubButton']=(I,r)=>{C&&(I['openlink']=C),t=wx['createGameClubButton'](I),r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['onTapGameClubButton']=I=>{t&&t['onTap'](I);},this['offTapGameClubButton']=I=>{t&&(!I?t['offTap']():t['offTap'](I));},this['showGameClubButton']=()=>{t&&t['show']();},this['hideGameClubButton']=()=>{t&&t['hide']();},this['destroyGameClubButton']=()=>{t&&(t['destroy'](),t=null);},this['requestSubscribeMessage']=(I,r)=>{wx['requestSubscribeMessage']({'tmplIds':I,'success':Y=>{let A=Object['keys'](Y)['filter'](J=>Y[J]==='accept');r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':A});},'fail':Y=>{r({'code':CodeStatus['FAILED'],'message':Y['errMsg'],'data':null});}});},this['requestSubscribeSystemMessage']=(I,r)=>{wx['requestSubscribeSystemMessage']({'msgTypeList':I,'success':Y=>{let A=Object['keys'](Y)['filter'](J=>Y[J]==='accept');r({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':A});},'fail':Y=>{r({'code':CodeStatus['FAILED'],'message':Y['errMsg'],'data':null});}});};}static['getIns'](){return!this['ins']&&(this['ins']=new EyouClientV2()),this['ins'];}}module['exports']=EyouClientV2;class CodeStatus{static ['SUCCESS']=0x0;static ['FAILED']=-0x1;static ['GAME_SESSION_KEY_TIME_OUT_ERR']=0x2729;}class AdType{static ['REWARDED_VIDEO_AD']=0x1;static ['BANNER_AD']=0x2;}class AdActionType{static ['SHOW']=0x1;static ['FINISHED']=0x2;}