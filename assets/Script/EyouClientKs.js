const BASE_URL='https://games.hndibei.com';class EyouClientKs{constructor(){let C=null,t=0x9,i=null,e=null,m='-1',a='-1',p='4',X=null,K=null,T=null,z=null,k=null,P=null;const Z=new Map();let r=null;const g=()=>{return new Promise((J,D)=>{ks['login']({'force':!![],'success':({code:u})=>{u?(console['log']('code:>',u),J(u)):D(new Error('获取code失败'));},'fail':D});});},y=J=>{C=J;const D=ks['getSystemInfoSync']();p=D['platform']==='android'?'4':D['platform']==='ios'?'5':'6';const u=ks['getLaunchOptionsSync']()['query'];u&&(i=u['channel'],e=u['sub_channel']);const s={'10913':['unit_id','callback']};if(s['hasOwnProperty'](i)){const [S,o]=s[i];m=u[S],a=u[o];}else i='10906',e=''+C+t+i+p+'0';},A=(J,D)=>{J['gameId']=C,(J['platformId']=t,J['sys']=p),v(J)['then'](u=>{console['log']('拉起支付返参:',u);if(u['payType']==0xc)u['balance']>0x0?n('充值提示','账户余额:'+u['balance']+'元,\x20还需充值:'+u['needPay']+'元',()=>b(u)):b(u,D);else{if(u['payType']==0x4)ks['showModal']({'title':'充值提示','content':'即将展示充值二维码,\x20请扫描二维码完成支付','success':function(s){if(s['confirm']){const S=ks['getSystemInfoSync']();let o=ks['createCanvas']();console['log'](S['windowWidth'],S['windowHeight']);let U=o['getContext']('2d');const l=ks['createImage']();l['src']=u['payUrl'],console['log']('atlas:',JSON['stringify'](l)),console['log']('payUrl:',u['payUrl']),console['log']('atlas.src:',l['src']),l['onload']=R=>{console['log']('图片加载结果:',R),U['drawImage'](l,S['windowWidth']/0x3,0x0,0x12c,0x1c2);};}}});else throw new Error('非法支付类型');}});},b=(J,D)=>{if(J['needPay']==0x0){h(J,D);return;}let u={};u['success']=S=>{console['log']('支付结果:',JSON['stringify'](S));},u['fail']=S=>{console['log']('支付失败:',JSON['stringify'](S));};const s=ks['getSystemInfoSync']();console['log']('设备信息:',s),u['zone_id']=J['zoneId'],u['os']=s['platform'],u['currency_type']='CNY',u['buy_quantity']=J['needPay']*J['rate'],u['third_party_trade_no']=J['orderId'],u['sign']=J['sign'],s['platform']==='ios'&&(u['product_type']=0x1),console['log']('支付参数:',u),ks['requestGamePayment'](u);},M=BASE_URL+'/market-multi-game-server/kuaiShouClient/pullPay',v=async J=>{const D=0x3;let u=0x0,s=![],S=![];while(u<D&&!s){try{const o=await H(M,J);console['log']('游戏拉起支付结果:',o);if(o['code']===CodeStatus['SUCCESS'])return o['data'];else!S&&(n('支付拉起失败',o['message']),S=!![]);}catch(U){!S&&(n('支付拉起失败','网络超时'),S=!![]);}u++;}throw new Error('支付拉起失败');},n=(J,D,u,s)=>{ks['showModal']({'title':J,'content':D,'success':function(S){if(S['confirm']&&u)u();else S['cancel']&&s&&s();}});},N=BASE_URL+'/market-multi-game-server/kuaiShouClient/deduct',h=async(J,D)=>{try{const u={'orderId':J['orderId'],'gameId':C,'platformId':t,'userId':J['userId']},s=await H(N,u);s['code']===CodeStatus['SUCCESS']&&D(s);}catch(S){console['error']('[扣款失败]异常:>',S);}},O=BASE_URL+'/market-multi-game-server/kuaiShouClient/adAction',w=(J,D,u)=>{let s={'gameId':C,'platformId':t,'channelId':i,'subChannelId':e,'aid':m,'traceId':a,'sys':p,'userId':K,'adType':J,'adUnitId':D,'adActionType':u};H(O,s)['catch'](S=>{console['log']('发送广告行为失败:>',S);});},F=()=>{if(!r)throw new Error('未创建录屏管理器');},H=(J,D)=>{return new Promise((u,s)=>{ks['request']({'url':J,'method':'POST','header':{'Content-Type':'application/json'},'data':JSON['stringify'](D),'fail':s,'success':function(S){console['log']('成功响应:>',JSON['stringify'](S['data'])),u(S['data']);},'fail':function(S){console['log']('失败响应:>',JSON['stringify'](S));},'complete':function(S){console['log']('---------------------------------请求\x20BEGIN--------------------------------'),console['log']('Url:>',J),console['log']('请求参数:>',D),console['log']('---------------------------------请求\x20END--------------------------------');}});});},c=BASE_URL+'/market-multi-game-server/kuaiShouClient/initGame';this['init']=async(J,D)=>{try{ks['onShareAppMessage'](S=>{return{'templateId':z,'query':'','success':()=>{console['log']('分享成功');},'fail':o=>{console['log']('分享失败',o);}};}),X=await g(),y(J);const u={'code':X,'gameId':C,'platformId':t,'channelId':i,'subChannelId':e,'aid':m,'traceId':a,'sys':p},s=await H(c,u);s['code']===CodeStatus['SUCCESS']&&(K=s['data']['userId'],T=s['data']['unionId'],z=s['data']['shareTemplateId'],s['data']=null),D(s);}catch(S){console['error']('[初始化游戏]异常:>',S);}},this['login']=async J=>{J({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':{'code':X}});};const L=BASE_URL+'/market-multi-game-server/kuaiShouClient/uploadRoleInfo';this['uploadRoleInfo']=async(J,D)=>{try{J['gameId']=C,J['platformId']=t;const u=await H(L,J);D(u);}catch(s){console['error']('上报角色数据异常:>',s);}},this['pay']=async(J,D)=>{try{A(J,D);}catch(u){console['error']('[支付拉起]异常:>',u);}};const x=BASE_URL+'/market-multi-game-server/kuaiShouClient/antidirt';this['antidirt']=async(J,D)=>{try{let u={'gameId':C,'platformId':t,'contents':J};const s=await H(x,u);D(s);}catch(S){console['error']('[内容安全检测]异常:>',S);}},this['createRewardedVideoAd']=(J,D)=>{let u={'adUnitId':J['adUnitId']};J['multiton']&&(u['multiton']=J['multiton'],u['multitonRewardMsg']=J['multitonRewardMsg'],u['multitonRewardTimes']=J['multitonRewardTimes']),J['progressTip']&&(u['progressTip']=J['progressTip']),P=ks['createRewardedVideoAd'](u),P['onClose'](s=>{s&&s['isEnded']&&(w(AdType['REWARDED_VIDEO_AD'],k,AdActionType['FINISHED']),console['log']('正常播放结束，可以下发游戏奖励')),J['onClose']&&J['onClose'](s),P['destroy']();}),J['onError']&&P['onError'](s=>{J['onError']&&J['onError'](s),P['destroy']();}),k=J['adUnitId'],D({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['showRewardedVideoAd']=()=>{P&&(P['load'](),P['show']()['then'](()=>w(AdType['REWARDED_VIDEO_AD'],k,AdActionType['SHOW']))['catch'](J=>{P['load']()['then'](()=>{P['show']()['then'](()=>w(AdType['REWARDED_VIDEO_AD'],k,AdActionType['SHOW']));})['catch'](D=>console['log']('激励视频\x20广告显示失败'));}));},this['createGameRecorder']=(J,D)=>{r=ks['getGameRecorder'](),J['onStart']&&r['on']('start',J['onStart']),J['onResume']&&r['on']('resume',J['onResume']),J['onPause']&&r['on']('pause',J['onPause']),J['onStop']&&r['on']('stop',J['onStop']),J['onError']&&r['on']('error',J['onError']),J['onAbort']&&r['on']('abort',J['onAbort']),D({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},this['gameRecorderStart']=J=>{F(),r['start'](J);},this['gameRecorderPause']=()=>{F(),r['pause']();},this['gameRecorderResume']=()=>{F(),r['resume']();},this['gameRecorderStop']=()=>{F(),console['log']('触发停止录屏'),r['stop']();},this['publishVideo']=J=>{F(),r['publishVideo']({'video':J['videoID'],'callback':D=>{if(D!=null&&D!=undefined){console['log']('分享录屏失败:\x20',D);return;}console['log']('分享录屏成功');}});},this['shareAppMessage']=(J,D)=>{ks['shareAppMessage']({...J,'templateId':z,'success':()=>{D({'code':CodeStatus['SUCCESS'],'message':'操作成功','data':null});},'fail':u=>{console['log']('[分享失败]:>',u),D({'code':CodeStatus['FAIL'],'message':'操作失败','data':null});}});},this['addShortcut']=J=>{ks['addShortcut']({'complete':J});},this['checkShortcut']=J=>{ks['checkShortcut']({'complete':J});},this['addCommonUse']=J=>{ks['addCommonUse']({'complete':J});},this['checkCommonUse']=J=>{ks['checkCommonUse']({'complete':J});};}static['getIns'](){return!this['ins']&&(console['log']('初始化'),this['ins']=new EyouClientKs()),this['ins'];}}module['exports']=EyouClientKs;class CodeStatus{static ['SUCCESS']=0x0;static ['FAIL']=-0x1;}class AdType{static ['REWARDED_VIDEO_AD']=0x1;static ['BANNER_AD']=0x2;}class AdActionType{static ['SHOW']=0x1;static ['FINISHED']=0x2;}